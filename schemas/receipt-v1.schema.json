{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/receipt-v1.schema.json",
  "title": "AI Trust Receipt v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version","issued_at","nonce","alg","hash_alg","kid",
    "task_hash","model_hash","input_commitment","output_commitment",
    "policies","costs","canonical_hash","signature"
  ],
  "properties": {
    "schema_version": { "const": "1.0" },
    "issued_at": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[^Z]+Z$" },
    "nonce": { "type": "string", "pattern": "^[A-Za-z0-9_-]{22,24}$" },
    "alg": { "type": "string", "const": "Ed25519" },
    "hash_alg": { "type": "string", "const": "SHA-256" },
    "kid": { "type": "string", "pattern": "^(did:key:[A-Za-z0-9:_-]+|[A-Fa-f0-9]{64})$" },
    "task_hash": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "model_hash": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "input_commitment": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "output_commitment": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "policies": {
      "type": "object", "additionalProperties": false,
      "required": ["satisfied","relaxed"],
      "properties": {
        "satisfied": { "type": "array", "items": { "type": "string", "pattern": "^[A-Z_0-9]{3,}$" } },
        "relaxed":   { "type": "array", "items": { "type": "string", "pattern": "^[A-Z_0-9]{3,}$" } }
      }
    },
    "costs": {
      "type": "object", "additionalProperties": false,
      "required": ["latency_ms","energy_j"],
      "properties": {
        "latency_ms": { "type": "integer", "minimum": 0 },
        "energy_j": { "type": "number", "minimum": 0 }
      }
    },
    "payload_summary": { "type": "string", "maxLength": 128 },
    "canonical_hash": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "signature": { "type": "string", "pattern": "^[A-Za-z0-9_-]{86}$" },
    "log_id": { "type": "string" },
    "leaf_hash": { "type": "string", "pattern": "^sha256:[A-Za-z0-9_-]{43,}$" },
    "tree_size": { "type": "integer", "minimum": 0 },
    "inclusion_proof": {
      "type": "object", "additionalProperties": false,
      "required": ["leaf_index","path","path_directions"],
      "properties": {
        "leaf_index": { "type": "integer", "minimum": 0 },
        "path": { "type": "array", "items": { "type": "string", "pattern": "^[A-Za-z0-9_-]{43,}$" } },
        "path_directions": { "type": "string", "pattern": "^[LR]+$" }
      }
    }
  }
}
